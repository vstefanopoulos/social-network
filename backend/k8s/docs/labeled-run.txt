Create cnpg name space:

kubectl apply --server-side -f \
  https://raw.githubusercontent.com/cloudnative-pg/cloudnative-pg/release-1.28/releases/cnpg-1.28.0.yaml


# 1. Namespaces
kubectl apply -R -f k8s --selector stage=namespace

# 1.1 Configs / Secrets
kubectl apply -R -f k8s --selector stage=config

# 2. Helm nginx
helm upgrade --install nginx-ingress ingress-nginx/ingress-nginx \
    -n ingress-nginx --create-namespace

# 3. PVCs (deprecated)
kubectl apply -R -f k8s --selector stage=pvc


# 4. DB
kubectl apply -R -f k8s --selector stage=db

# 5. DB migration Jobs
kubectl apply -R -f k8s --selector stage=migration

# 6. App Deployments + Services
kubectl apply -R -f k8s --selector stage=app

# 7. Ingress
kubectl apply -R -f k8s --selector stage=ingress
